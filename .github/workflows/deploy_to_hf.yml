name: Deploy to Hugging Face Spaces

on:
  # 当代码推送到 main 分支时触发
  push:
    branches:
      - main

jobs:
  deploy-to-hub:
    runs-on: ubuntu-latest
    steps:
      # 步骤 1: 检出您的 GitHub 仓库代码
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          lfs: true

      # 步骤 2: 将代码直接推送到 Hugging Face Space 的 Git 仓库
      # 这个方法绕过了所有 Docker 客户端的大小写问题
      - name: Push to Hugging Face Hub
        env:
          # HF_SPACE_NAME 的格式应为 "用户名/Space名"，例如 "Liu9299/my-ecommerce-agent"
          # HF_TOKEN 是一个具有 write 权限的 Hugging Face 访问令牌
          HF_SPACE_NAME: ${{ secrets.HF_SPACE_NAME }}
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          # 使用您的 HF_TOKEN 作为密码，将代码强制推送到 Space 仓库的 main 分支
          # 我们使用 "user" 作为 git 用户名，这是使用 token 进行认证的推荐方式
          git push "https://user:${HF_TOKEN}@huggingface.co/spaces/${HF_SPACE_NAME}" main --force